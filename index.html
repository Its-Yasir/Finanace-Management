<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Personal Expense Tracker - Login and manage your finances"
    />
    <title>Login - Personal Expense Tracker</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="assets/logo.svg">
    <link rel="alternate icon" href="assets/logo.png">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- FontAwesome Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
  <!-- Fixed Theme Toggle Button -->
  <button id="themeToggle" class="theme-toggle-fixed" aria-label="Toggle theme">
    <i class="fas fa-moon"></i>
  </button>

  <!-- Authentication Container -->
  <div class="auth-container">
    <div class="auth-card">
      <!-- Compact Header with Inline Logo -->
      <div class="auth-logo-inline">
        <img src="assets/logo.svg" onerror="this.onerror=null; this.src='assets/logo.png';" alt="Logo">
        <h1>Personal Expense Tracker</h1>
      </div>

      <!-- Error/Success Messages -->
      <div id="messageContainer"></div>

      <!-- Login Form -->
      <form id="loginForm">
        <div class="form-group">
          <label for="loginEmail" class="form-label">
            <i class="fas fa-envelope"></i> Email Address
          </label>
          <input
            type="email"
            id="loginEmail"
            class="form-input"
            placeholder="Enter your email"
            required
            autocomplete="email"
          />
        </div>

        <div class="form-group">
          <label for="loginPassword" class="form-label">
            <i class="fas fa-lock"></i> Password
          </label>
          <input
            type="password"
            id="loginPassword"
            class="form-input"
            placeholder="Enter your password"
            required
            autocomplete="current-password"
          />
        </div>

        <button type="submit" class="btn btn-primary" style="width: 100%">
          <i class="fas fa-sign-in-alt"></i> Login
        </button>
      </form>

      <!-- Register Form (Hidden by default) -->
      <form id="registerForm" class="hidden">
        <div class="form-group">
          <div class="input-with-icon">
            <i class="fas fa-user"></i>
            <input
              type="text"
              id="registerName"
              class="form-input"
              placeholder="Username"
              required
              autocomplete="name"
            />
          </div>
        </div>

        <div class="form-group">
          <div class="input-with-icon">
            <i class="fas fa-envelope"></i>
            <input
              type="email"
              id="registerEmail"
              class="form-input"
              placeholder="Email Address"
              required
              autocomplete="email"
            />
          </div>
        </div>

        <div class="form-group">
          <div class="input-with-icon">
            <i class="fas fa-lock"></i>
            <input
              type="password"
              id="registerPassword"
              class="form-input"
              placeholder="Password (min 6 characters)"
              required
              autocomplete="new-password"
            />
          </div>
        </div>

        <div class="form-group">
          <div class="input-with-icon">
            <i class="fas fa-lock"></i>
            <input
              type="password"
              id="registerPasswordConfirm"
              class="form-input"
              placeholder="Confirm Password"
              required
              autocomplete="new-password"
            />
          </div>
        </div>

        <button type="submit" class="btn btn-primary" style="width: 100%">
          <i class="fas fa-user-plus"></i> Register
        </button>
      </form>

      <!-- Toggle between Login/Register -->
      <div class="auth-toggle">
        <p id="toggleText">
          Don't have an account?
          <a href="#" id="toggleLink">Register here</a>
        </p>
      </div>
    </div>
  </div>

    <!-- Loading Spinner -->
    <div id="loading" class="loading">
      <div class="spinner"></div>
    </div>
    <script type="module">
      // Import authentication functions
      import {
        loginUser,
        registerUser,
        redirectIfAuthenticated,
      } from "./auth.js";

      import { loadTheme, toggleTheme, showError, showSuccess } from "./app.js";

      // Check if user is already logged in
      redirectIfAuthenticated();

      // Load theme on page load
      loadTheme();

      // Theme toggle functionality
      const themeToggle = document.getElementById("themeToggle");
      themeToggle.addEventListener("click", toggleTheme);

      // Form elements
      const loginForm = document.getElementById("loginForm");
      const registerForm = document.getElementById("registerForm");
      const toggleText = document.getElementById("toggleText");
      const loading = document.getElementById("loading");
      const authCard = document.querySelector(".auth-card");

      let isLogin = true;

      // Toggle function
      function toggleForms(e) {
        e.preventDefault();
        
        // Add flip animation
        authCard.classList.add("flipping");
        
        // Wait a bit before changing forms (mid-flip)
        setTimeout(() => {
          if (isLogin) {
            // Switch to register
            loginForm.classList.add("hidden");
            registerForm.classList.remove("hidden");
            toggleText.innerHTML = 'Already have an account? <a href="#" id="toggleLink">Login here</a>';
            isLogin = false;
          } else {
            // Switch to login
            registerForm.classList.add("hidden");
            loginForm.classList.remove("hidden");
            toggleText.innerHTML = 'Don\'t have an account? <a href="#" id="toggleLink">Register here</a>';
            isLogin = true;
          }
          
          // Re-attach event listener to new link
          document.getElementById("toggleLink").addEventListener("click", toggleForms);
        }, 400); // Change forms halfway through animation
        
        // Remove animation class after animation completes
        setTimeout(() => {
          authCard.classList.remove("flipping");
        }, 800);
      }

      // Initial toggle link attachment
      document.getElementById("toggleLink").addEventListener("click", toggleForms);

      // Handle login form submission
      loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = document.getElementById("loginEmail").value;
        const password = document.getElementById("loginPassword").value;

        // Show loading
        loading.classList.add("active");

        try {
          // Attempt login
          await loginUser(email, password);

          // Show success message
          showSuccess("Login successful! Redirecting...", "messageContainer");

          // Redirect to dashboard
          setTimeout(() => {
            window.location.href = "dashboard.html";
          }, 1000);
        } catch (error) {
          // Hide loading
          loading.classList.remove("active");

          // Show error message
          showError(error.message, "messageContainer");
        }
      });

      // Handle register form submission
      registerForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = document.getElementById("registerEmail").value;
        const password = document.getElementById("registerPassword").value;
        const passwordConfirm = document.getElementById(
          "registerPasswordConfirm"
        ).value;

        // Validate passwords match
        if (password !== passwordConfirm) {
          showError("Passwords do not match", "messageContainer");
          return;
        }

        // Show loading
        loading.classList.add("active");

        try {
          // Get username
          const name = document.getElementById("registerName").value;
          
          // Attempt registration with username
          await registerUser(email, password, name);

          // Show success message
          showSuccess(
            "Registration successful! Redirecting...",
            "messageContainer"
          );

          // Redirect to dashboard
          setTimeout(() => {
            window.location.href = "dashboard.html";
          }, 1000);
        } catch (error) {
          // Hide loading
          loading.classList.remove("active");

          // Show error message
          showError(error.message, "messageContainer");
        }
      });
    </script>
    <!-- Firebase and Auth Script -->

  </body>
</html>
